document.getElementById('button-addon2').addEventListener('click', async () => {
    const fileInput = document.getElementById('file-input').files[0];
    
    // Reference to the scan result section and message containers
    const scanResultSection = document.getElementById('scan-result-section');
    const scanResultMessage = document.getElementById('scan-result-message');
    const errorMessage = document.getElementById('error-message');

    const access_token = localStorage.getItem("access_token"); 
    console.log(access_token);
   
    if (!access_token) {
        console.log("You are not authenticated. Please log in.");
        window.location.href = "/login.html";
        return;
    }

    if (!fileInput) {   
        errorMessage.textContent = 'Please select a file to upload';
        return;
    }

    try {
        // Reset error message
        errorMessage.textContent = '';

        // Create FormData object to send the file
        const formData = new FormData();
        formData.append('uploaded_file', fileInput);

        // Make the POST request to the backend API
        const response = await fetch('http://127.0.0.1:8000/api/intrusion-net/file-scan/', {
            method: 'POST',
            headers: {
                "Authorization": `Bearer ${access_token}`,
                // "Content-Type": "application/json"
            },
            body: formData,

        });

        if (response.ok) {
            console.log("request complete!");
            const result = await response.json();

            // Display scan result dynamically
            scanResultMessage.textContent = `Scan successful: ${JSON.stringify(result)}`;
            
            // Show the scan result section
            scanResultSection.style.display = 'block';
        } else {
            const errorResponse = await response.text();
            errorMessage.textContent = `Error scanning file: ${errorResponse}`;
        }
    } catch (error) {
        console.error('Error:', error);
        errorMessage.textContent = 'An unexpected error occurred.';
    }
});
